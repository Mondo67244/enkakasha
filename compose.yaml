services:
  backend:
    build:
      context: .
      dockerfile: backend.Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data # Persistance des donn√©es (scans)
    environment:
      - FLARESOLVERR_URL=http://flaresolverr:8191/v1
      - OLLAMA_HOST=http://172.17.0.1:11434
      - OLLAMA_MODEL=mistral:7b
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - flaresolverr
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: frontend.Dockerfile
    ports:
      - "5173:80" # On expose sur 5173 pour tester (ou on changera pour 80/443 via le Caddy externe)
    depends_on:
      - backend
    restart: unless-stopped

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=none
      - TZ=Europe/Paris
    restart: unless-stopped
    expose:
      - "8191"
